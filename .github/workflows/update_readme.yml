name: Update Readme
on:
  schedule:
    - cron:  '0 0 * * MON'
  workflow_dispatch:

jobs:
  Update_Readme:
    runs-on: ubuntu-latest
    steps:
      - 
        name: Private Actions Checkout
        uses: actions/checkout@v2.3.4
        with:
          persist-credentials: false
          fetch-depth: 0
      - 
        name: Create local changes
        run: |
          echo 'IyBKdXB5dGVyIFJ1c3QKCiFbdmVyc2lvbl0oaHR0cHM6Ly9pbWcuc2hpZWxkcy5pby9iYWRnZS9EYXRlLQ==' | base64 -d > README.md
          echo $(date "+%Y_%m_%d")$(echo 'LWRhMjgyYSkgWyFbRG9ja2VyIEF1dG9tYXRlZCBCdWlsZF0oaHR0cHM6Ly9pbWcuc2hpZWxkcy5pby9kb2NrZXIvYXV0b21hdGVkL3hyc2VjL2p1cHl0ZXJfcnVzdD9sYWJlbD1CdWlsZCZsb2dvPWRvY2tlciZzdHlsZT1mbGF0LXNxdWFyZSldKGh0dHBzOi8vaHViLmRvY2tlci5jb20vci94cnNlYy9qdXB5dGVyX3J1c3QpIFshW0p1cHl0ZXIgRG9ja2VyIEJ1aWxkXShodHRwczovL2dpdGh1Yi5jb20vWFJTZWMvSnVweXRlcl9SdXN0L2FjdGlvbnMvd29ya2Zsb3dzL2p1cHl0ZXIueW1sL2JhZGdlLnN2ZyldKGh0dHBzOi8vZ2l0aHViLmNvbS9YUlNlYy9KdXB5dGVyX1J1c3QvYWN0aW9ucy93b3JrZmxvd3MvanVweXRlci55bWwpIFshW3ZlcnNpb25dKGh0dHBzOi8vaW1nLnNoaWVsZHMuaW8vYmFkZ2UvRnJvbS1nb29nbGUvZXZjeHItZGEyODJhKV0oaHR0cHM6Ly9naXRodWIuY29tL2dvb2dsZS9ldmN4cik=' | base64 -d) >> README.md
          echo 'Ci0gdXNlIFtnb29nbGUvZXZjeHJdKGh0dHBzOi8vZ2l0aHViLmNvbS9nb29nbGUvZXZjeHIpCgojIyBSdW4KCmBgYGJhc2gKZG9ja2VyIHJ1biAtaXQgLWQgXAotLXJlc3RhcnQ9YWx3YXlzIFwKLS1uYW1lIGp1cHl0ZXIgXAotdiAiL2RvY2tlci9qdXB5dGVyOi9yb290IiBcCi1wIDg4ODg6ODg4OCBcCnhyc2VjL2p1cHl0ZXJfcnVzdAoKIyBzZXQgcGFzc3dvcmQKZG9ja2VyIGV4ZWMgLWl0IGp1cHl0ZXIgYmFzaApqdXB5dGVyIG5vdGVib29rIHBhc3N3b3JkCmNhdCAvcm9vdC8uanVweXRlci9qdXB5dGVyX25vdGVib29rX2NvbmZpZy5qc29uIHwgZ3JlcCBwYXNzd29yZCB8IGN1dCAtZCAnIicgLWYgNApleGl0CiMgUGxlYXNlIGVkaXQgL2RvY2tlci9qdXB5dGVyLy5qdXB5dGVyL2p1cHl0ZXJfbm90ZWJvb2tfY29uZmlnLnB5ICYgZmluZCAjIGMuTm90ZWJvb2tBcHAucGFzc3dvcmQgPSAnJwojIGxpa2UgYXJnb24yOiRhcmdvbjJpZCR2PTE5JG09MTAyNDAsdD0xMCxwPTgkbmFkd25OWVI5ZGd0ZGl0eHVuV1paZyQrQTVCR3c3SnJpWVUzWTJ5T093NFlBCmBgYAoKPGhyPgoK' | base64 -d >> README.md
          curl -s $(curl -u ${{ secrets.DOCKERHUB_USERNAME }}:${{ secrets.TOKEN_GITHUB }} -s 'https://api.github.com/repos/google/evcxr/contents/evcxr_jupyter/README.md' | grep "download_url" | cut -d '"' -f 4) >> README.md
      - 
        name: Commit files
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add README.md
          git commit -m "Add changes by Jupyter_Update_Action" -a
      - 
        name: Push changes
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.TOKEN_GITHUB }}
          branch: ${{ github.ref }}

  Repository_Dispatch:
    needs: Update_Readme
    runs-on: ubuntu-latest
    steps:
      - 
        name: Repository Dispatch
        uses: peter-evans/repository-dispatch@v1
        with:
          token: ${{ secrets.TOKEN_GITHUB }}
          event-type: Jupyter_Update_Action
